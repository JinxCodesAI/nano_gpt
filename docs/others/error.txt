
Overriding config with .\config\sequence_scorer_complex.py:
"""Advanced configuration for sequence scoring dataset with stage-based generation"""     

# Dataset configuration
dataset = 'sequence_scorer'
batch_size = 16
block_size = 256

# MLM model for synthetic text generation
mlm_checkpoint_path = 'out/7250_1.76_all_LMod_enabled.pt'  # adjust to your MLM checkpoint
cls_token_id = 66

# Load composition configuration (same as char_diffusion)
composition_config = 'complex'  # reuses data/char_diffusion/config/complex.py

# Load globals from composition config if present
if composition_config is not None:
    import os
    config_path = os.path.join('data', 'char_diffusion', 'config', f'{composition_config}.py')
    if os.path.exists(config_path):
        import importlib.util
        spec = importlib.util.spec_from_file_location(f"{composition_config}_config", config_path)
        config_module = importlib.util.module_from_spec(spec)
        spec.loader.exec_module(config_module)
        for attr_name in dir(config_module):
            if not attr_name.startswith('_'):
                globals()[attr_name] = getattr(config_module, attr_name)
        print(f"Loaded composition config from {config_path}")
    else:
        print(f"Warning: composition config file not found at {config_path}")
else:
    use_all_stages_for_training = None
    unmasking_stages = None
    validation_stages = None

# Model mode configuration
model_mode = 'sequence_scorer'
attention_type = 'bidirectional'

# Training settings optimized for sequence scoring
learning_rate = 1e-4
warmup_iters = 300
max_iters = 8000
eval_interval = 200

# Data generation settings
batches_per_file = 30
max_backlog_files = 2
sleep_seconds = 8.0

print("Complex sequence scorer configuration loaded")


Loaded composition config from data\char_diffusion\config\complex.py
Complex sequence scorer configuration loaded
tokens per iteration will be: 163,840
found vocab_size = 66 (from consumer.meta)
Initializing a new model from scratch
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using bidirectional attention
Using absolute position embeddings
Sequence scorer head: continuous score 0-1
number of parameters: 85.01M
E:\AI\projects\diffusion\train.py:253: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler(enabled=(dtype == 'float16'))
num decayed parameter tensors: 51, with 85,182,720 parameters
num non-decayed parameter tensors: 25, with 19,200 parameters
using fused AdamW: True
compiling the model... (takes a ~minute)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] WON'T CONVERT forward E:\AI\projects\diffusion\model.py line 457
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] due to:
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] Traceback (most recent call last):
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 1164, in __call__
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     result = self._inner_convert(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 547, in __call__
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return _compile(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 1036, in _compile
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     raise InternalTorchDynamoError(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 986, in _compile
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     guarded_code = compile_inner(code, one_graph, hooks, transform)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 715, in compile_inner
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return _compile_inner(code, one_graph, hooks, transform)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_utils_internal.py", line 95, in wrapper_function
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return function(*args, **kwargs)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 750, in _compile_inner
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     out_code = transform_code_object(code, transform)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\bytecode_transformation.py", line 1361, in transform_code_object        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     transformations(instructions, code_options)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 231, in _fn
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return fn(*args, **kwargs)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 662, in transform
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     tracer.run()
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 2868, in run
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     super().run()
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 1052, in run
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     while self.step():
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 962, in step
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     self.dispatch_table[inst.opcode](self, inst)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 1800, in LOAD_ATTR
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     self._load_attr(inst)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 1790, in _load_attr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     result = BuiltinVariable(getattr).call_function(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 1004, in call_function
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return handler(tx, args, kwargs)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 717, in <lambda>
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return lambda tx, args, kwargs: obj.call_function(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 1004, in call_function
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return handler(tx, args, kwargs)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 852, in builtin_dispatch
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     rv = fn(tx, args, kwargs)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 772, in call_self_handler
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     result = self_handler(tx, *args, **kwargs)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 1704, in call_getattr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return obj.var_getattr(tx, name)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\base.py", line 328, in var_getattr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     value = self.const_getattr(tx, name)    
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\constant.py", line 113, in const_getattr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     member = getattr(self.value, name)      
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] torch._dynamo.exc.InternalTorchDynamoError: 
AttributeError: 'str' object has no attribute 'device'
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] from user code:
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]    File "E:\AI\projects\diffusion\model.py", line 458, in forward
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     device = idx.device
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] Traceback (most recent call last):
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 1164, in __call__
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     result = self._inner_convert(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 547, in __call__
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return _compile(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 1036, in _compile
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     raise InternalTorchDynamoError(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 986, in _compile
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     guarded_code = compile_inner(code, one_graph, hooks, transform)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 715, in compile_inner
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return _compile_inner(code, one_graph, hooks, transform)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_utils_internal.py", line 95, in wrapper_function
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return function(*args, **kwargs)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 750, in _compile_inner
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     out_code = transform_code_object(code, transform)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\bytecode_transformation.py", line 1361, in transform_code_object        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     transformations(instructions, code_options)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 231, in _fn
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return fn(*args, **kwargs)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\convert_frame.py", line 662, in transform
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     tracer.run()
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 2868, in run
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     super().run()
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 1052, in run
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     while self.step():
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 962, in step
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     self.dispatch_table[inst.opcode](self, inst)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 1800, in LOAD_ATTR
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     self._load_attr(inst)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\symbolic_convert.py", line 1790, in _load_attr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     result = BuiltinVariable(getattr).call_function(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 1004, in call_function
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return handler(tx, args, kwargs)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 717, in <lambda>
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return lambda tx, args, kwargs: obj.call_function(
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 1004, in call_function
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return handler(tx, args, kwargs)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 852, in builtin_dispatch
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     rv = fn(tx, args, kwargs)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 772, in call_self_handler
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     result = self_handler(tx, *args, **kwargs)
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\builtin.py", line 1704, in call_getattr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     return obj.var_getattr(tx, name)        
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\base.py", line 328, in var_getattr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     value = self.const_getattr(tx, name)    
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]   File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\variables\constant.py", line 113, in const_getattr
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     member = getattr(self.value, name)      
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] torch._dynamo.exc.InternalTorchDynamoError: 
AttributeError: 'str' object has no attribute 'device'
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] from user code:
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]    File "E:\AI\projects\diffusion\model.py", line 458, in forward
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]     device = idx.device
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233] Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information
W0913 08:46:47.477333 2176 site-packages\torch\_dynamo\convert_frame.py:1233]
Traceback (most recent call last):
  File "E:\AI\projects\diffusion\train.py", line 309, in <module>
    losses = evaluator.evaluate()
  File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\_contextlib.py", line 116, in 
decorate_context
    return func(*args, **kwargs)
  File "E:\AI\projects\diffusion\core\evaluator.py", line 74, in evaluate
    logits, loss = self.model(X, Y, loss_modifiers=self.loss_modifier_pipeline)
  File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_dynamo\eval_frame.py", line 574, in _fn
    return fn(*args, **kwargs)
  File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\nn\modules\module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "C:\Users\Adam\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\nn\modules\module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "E:\AI\projects\diffusion\model.py", line 458, in forward
    device = idx.device
AttributeError: 'str' object has no attribute 'device'